include:
  - project: smp/iac/pipeline-common
    ref: 3.4.2
    file: common.yml

workflow:
  rules:
    - if: '$CI_PIPELINE_SOURCE != "merge_request_event"'

stages:
  - code_quality

cache:
  paths:
    - .m2/repository
    
variables:
  MVN_CMD: mvn -Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository -Denv.type=aws -Dgpg.skip
  SONAR_PROJECT_KEY: ldsdk_ldsdk-java
  WS_MAVEN_AGGREGATEMODULES: "true"
  WS_PROJECTNAME: "ldsdk-java"
  PATH_TO_DOCKERFILE: $CI_PROJECT_DIR

.rules-auto-on-validation:
  rules:
    - if: '$CI_COMMIT_REF_NAME == "validation"'
      when: on_success


######################
# Code quality stage #
######################

sonar-validate:
  extends: .sonar-base
  needs: []

whitesource-check-policies:
  extends:
    - .whitesource-check-policies
    - .rules-auto-on-validation
  allow_failure: true

whitesource-update:
  extends:
    - .whitesource-update
    - .rules-auto-on-validation
